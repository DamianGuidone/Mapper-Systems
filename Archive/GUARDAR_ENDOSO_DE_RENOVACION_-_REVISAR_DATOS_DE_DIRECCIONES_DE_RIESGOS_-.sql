/* GUARDAR ENDOSO DE RENOVACION - REVISAR DATOS DE DIRECCIONES DE RIESGOS - */
====================================================================================================
exec cot_execute_command @cod_command=1285,@patterns='policyId,tempCero, billingId, moveId,typeMove, nroPropInt, nroPropExt,nroCot',@values='50614013|4167932|1|5|1|123456|''''|''''',@query=default,@proc=1
    EXEC cot_separator_command @patterns, @values, @SQL OUTPUT
        EXEC @isValid = usp_validar_query @v_val
        EXEC @isValid = usp_validar_query @v_val
        EXEC @isValid = usp_validar_query @v_val
        EXEC @isValid = usp_validar_query @v_val
        EXEC @isValid = usp_validar_query @v_val
        EXEC @isValid = usp_validar_query @v_val
        EXEC @isValid = usp_validar_query @v_val
        EXEC @isValid = usp_validar_query @v_val
        emi_usp_renovacion_poliza 50614013, 4167932,1,5, 1, 0, 0,123456,'', '';
            EXEC sp_fecha_mov_suc @fec_emi, 1, 3, 1, @fecha_real = @fec_emi OUTPUT
                INSERT INTO @t EXEC dbo.usp_get_fecha_tope_modulo @cod_modulo
            SELECT @imp_cambio = dbo.emi_fn_get_currency_change(cod_moneda, getdate()) FROM pv_header WHERE id_pv = @id_pv_ult_endo
            EXEC emi_usp_renovacion_riesgos @id_pv ,@id_pv_cero ,@sn_aplica_depreciacion
                EXEC emi_recuperar_datos_riesgo_dview @id_pv_wkf = @id_pv, @id_pv_endo = @id_pv_cero
                    set @where = ' where ' + DBO.dview_getwhere(@id_view,@id_pv_wkf,0)
                    exec CargarVistasDinamicasEmision @id_pv_endo, @cod_ramo, @cod_usuario, @id_pv_wkf
                IF dbo.fn_Coinsured_Wkf(@id_pv) = -1
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @prima_tasa = dbo.RedondeaImporteEmision(CASE WHEN @nro_divisor_tasa = 1 THEN @tasa ELSE @suma_aseg * (@tasa / @nro_divisor_tasa) END, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_calcula_prima_cober @id_pv_wkf = @id_pv, @cod_item = @cod_item, @cod_tarifa = @cod_tarifa, @cod_ind_cob=@cod_ind_cob
                    SET @cod_tipo_tasa = CASE WHEN dbo.emi_fn_SNCalculoProrrata(@id_pv_wkf) = -1 THEN @cod_calculo_prorrata ELSE @cod_tipo_tasa END
                    EXECUTE emi_calcula_prima_cob @suma_aseg = @suma_aseg, @tasa = @pje_tasa, @cod_tipo_tasa = @cod_tipo_pje, @cod_forma_calculo = @cod_tipo_tasa, @fec_vig_desde = @fec_vig_desde, @fec_vig_hasta = @fec_vig_hasta, @id_pv_wkf = @id_pv_wkf, @id_pv_cero = @id_pv_cero, @cod_item = @cod_item, /* 0, */ @cod_cto_plazo = @cod_tcorto_plazo, @cod_ind_cob = @cod_ind_cob, @prima_tasa = @prima_tasa OUTPUT, @prima_neta = @prima_neta OUTPUT, @prima_recdesc = @prima_recdesc OUTPUT
                        SELECT @imp_prima_tasa_ant = (CASE WHEN tte.nro_divisor <> 1 THEN dbo.RedondeaImporteEmision((ISNULL(dcic.imp_suma_aseg_acum, dci.imp_suma_aseg_acum) / tte.nro_divisor * dc.pje_tasa), @cod_moneda) ELSE dc.pje_tasa END ) FROM pv_act pva INNER JOIN pv_header ph ON ph.id_pv = pva.id_pv_ult_dif_spp INNER JOIN di_cober dc ON dc.id_pv = pva.id_pv_ult_dif_spp AND dc.cod_item = pva.cod_item AND dc.cod_ind_cob = pva.cod_ind_cob INNER JOIN di_cober_imp dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = ph.cod_moneda LEFT JOIN di_cober_imp_coas dcic ON dcic.id_pv = dc.id_pv AND dcic.cod_item = dc.cod_item AND dcic.cod_ind_cob = dc.cod_ind_cob AND dcic.cod_moneda = ph.cod_moneda AND ph.cod_operacion = 3 INNER JOIN ttipo_tasa_emi tte ON tte.cod_tipo_tasa = dc.cod_tipo_pje WHERE pva.id_pv = (SELECT id_pv_cero FROM pv_header_wkf WHERE id_pv = @id_pv_wkf ) AND pva.cod_item = @cod_item AND pva.cod_ind_cob = @cod_ind_cob
                        SELECT @prima_neta = dbo.RedondeaImporteEmision((@prima_tasa - @imp_prima_tasa_ant) * @factor_prorrata, @cod_moneda)
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE di_cober_imp_wkf SET di_cober_imp_wkf.imp_prima = dbo.RedondeaImporteEmision(isnull(@prima_neta, 0), @cod_moneda), di_cober_imp_wkf.imp_prima_tasa = dbo.RedondeaImporteEmision(isnull(@prima_tasa, 0), @cod_moneda), di_cober_imp_wkf.imp_suma_aseg = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_declarado = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg * @cambio_signo END, @cod_moneda), /* VBLANCO - Este valor se grababa a cero */ di_cober_imp_wkf.imp_resp_max = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_buenrdo = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_buenrdo * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_resp_max_acc = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_resp_max_acc * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_parte_de = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_parte_de * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_asegurable = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_asegurable * @cambio_signo END, @cod_moneda), di_cober_imp_wkf.imp_suma_aseg_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_aseg_acum END, @cod_moneda), di_cober_imp_wkf.imp_suma_decl_acum = dbo.RedondeaImporteEmision(CASE WHEN @cod_estado = 'E' OR @cod_estado = 'R' OR @cod_estado = 'A' THEN 0 ELSE di_cober_imp_wkf.imp_suma_decl_acum END, @cod_moneda) WHERE id_pv = @id_pv_wkf AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_moneda = @cod_moneda
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                    UPDATE eq SET imp_prima = dbo.RedondeaImporteEmision(me.imp_prima * @imp_cambio, 0), imp_prima_tasa = dbo.RedondeaImporteEmision(me.imp_prima_tasa * @imp_cambio, 0), imp_suma_aseg = dbo.RedondeaImporteEmision(me.imp_suma_aseg * @imp_cambio, 0), imp_declarado = dbo.RedondeaImporteEmision(me.imp_declarado * @imp_cambio, 0), imp_resp_max = dbo.RedondeaImporteEmision(me.imp_resp_max * @imp_cambio, 0), imp_buenrdo = dbo.RedondeaImporteEmision(me.imp_buenrdo * @imp_cambio, 0), imp_resp_max_acc = dbo.RedondeaImporteEmision(me.imp_resp_max_acc * @imp_cambio, 0), imp_parte_de = dbo.RedondeaImporteEmision(me.imp_parte_de * @imp_cambio, 0), imp_suma_asegurable = dbo.RedondeaImporteEmision(me.imp_suma_asegurable * @imp_cambio, 0), imp_suma_aseg_acum = dbo.RedondeaImporteEmision(me.imp_suma_aseg_acum * @imp_cambio, 0), imp_suma_decl_acum = dbo.RedondeaImporteEmision(me.imp_suma_decl_acum * @imp_cambio, 0) FROM di_cober_imp_wkf eq INNER JOIN di_cober_imp_wkf me ON eq.id_pv = me.id_pv AND eq.cod_item = me.cod_item AND eq.cod_ind_cob = me.cod_ind_cob AND me.cod_moneda = @cod_moneda WHERE eq.id_pv = @id_pv_wkf AND eq.cod_item = @cod_item AND eq.cod_ind_cob = @cod_ind_cob AND eq.cod_moneda = 0
                EXEC emi_reindexar_cob @id_pv = @id_pv, @partic = @pje_partic
            EXEC emi_spc_datos_agente @id_pv
                EXEC dbo.revisa_importe_emision_tempdb_core
                EXEC emi_set_comis_ult_endo @id_pv_wkf
                EXEC emi_sp_calcula_comis @id_pv_wkf, -1, -1, 0, 1, @cod_criterio_comis
                    EXEC dbo.revisa_importe_emision_tempdb_core
            EXEC emi_usp_renovacion_texto @id_pv,@id_pv_cero
            EXEC emi_genera_solicitud @id_pv
                EXEC dbo.revisa_importe_emision_tempdb_core
                EXEC spi_RE_sumas_reasegurar @id_pv, -1, @id_pv
                    EXEC spu_RE_sumas_reasegurar_param @id_pv_wkf
                EXEC emi_usp_ajusta_prima_mov @id_pv
                    EXEC dbo.revisa_importe_emision_tempdb_core
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE di_pagador_wkf SET imp_participa_me = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100), @cod_moneda) /* avillagran */ ,imp_participa_eq = dbo.RedondeaImporteEmision((@prima_cober * @pje_participa / 100 * @imp_cambio), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv AND cod_item = @cod_item AND cod_ind_cob = @cod_ind_cob AND cod_ind_pagador = @cod_ind_pagador AND cod_aseg = @cod_aseg
                    UPDATE pv_importe_wkf SET imp_prima = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_prima_neto_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ ,imp_suma_asegurada = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_suma_aseg_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv
                    UPDATE pv_importe_wkf SET imp_prima = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_prima_neto_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ ,imp_suma_asegurada = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_suma_aseg_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv
                    UPDATE pv_importe_wkf SET imp_prima = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_prima_neto_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ ,imp_suma_asegurada = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_suma_aseg_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv
                    UPDATE pv_importe_wkf SET imp_prima = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_prima_neto_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ ,imp_suma_asegurada = dbo.RedondeaImporteEmision(( SELECT ISNULL(SUM(di_header_wkf.imp_suma_aseg_me),0) FROM di_header_wkf WHERE id_pv = @id_pv ), @cod_moneda) /* avillagran */ WHERE id_pv = @id_pv
                EXEC emi_crea_pv_agente @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                    UPDATE pvacw SET imp_prima_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100, @cod_moneda), imp_prima_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvaw.pje_partic /100 * @imp_cambio, 0), imp_comis_normal_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_normal_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_normal * pvaw.pje_partic / 10000 * @imp_cambio, 0), imp_comis_extra_me = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000, @cod_moneda), imp_comis_extra_eq = dbo.RedondeaImporteEmision(dci.imp_prima * pvacw.pje_comis_extra * pvaw.pje_partic / 10000 * @imp_cambio, 0) FROM pv_agente_comis_wkf pvacw INNER JOIN pv_agente_wkf pvaw ON pvacw.id_pv = pvaw.id_pv AND pvacw.ind_agente = pvaw.ind_agente INNER JOIN (SELECT isnull(sum(CASE WHEN dc.sn_acum_prima_total = - 1 THEN dci.imp_prima ELSE 0 END), 0) imp_prima, cod_ramo FROM di_cober_wkf dc INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda WHERE dc.id_pv = @id_pv GROUP BY cod_ramo) dci ON pvacw.cod_ramo = dci.cod_ramo WHERE pvacw.id_pv = @id_pv
                EXEC emi_consistencia_moneda @id_pv
                    EXEC dbo.revisa_importe_emision_tempdb_core
                EXEC emi_usp_carga_conceptos @id_pv = @id_pv, @cod_moneda = @cod_moneda, @cod_tipo_concepto = 2, @cod_concepto = @cod_concepto, @imp_concepto_me = @imp_gasto_emision
                    EXEC dbo.revisa_importe_emision_tempdb_core
                EXEC @sp_error = usp_ArmaPVImporteConcepto_wkf @id_pv = @id_pv, @cod_moneda = @cod_moneda, @cod_ramo = @cod_ramo, @sn_temporario = -1
                    exec usp_ArmaPVImporteConcepto_wkf_core @id_pv = @id_pv, @cod_moneda = @cod_moneda, @cod_ramo = @cod_ramo, @imp_base_calculo = @imp_base_calculo, @pje_recfin = @pje_recfin, @pje_iva = @pje_iva, @pje_deremi = @pje_deremi, @pje_descuento = @pje_descuento, @pje_decreto = @pje_decreto, @sn_temporario = @sn_temporario
                        EXEC dbo.revisa_importe_emision_tempdb_core
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 0, 2, 1, 1, 100, 0, imp_base_calculo * 29544.6900, 100, 0.00, dbo.RedondeaImporteEmision((imp_concepto * 29544.6900),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_importe_concepto_wkf WHERE id_pv = 50614013AND cod_moneda = 4 AND cod_tipo_concepto = 2 AND cod_concepto = 1
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 4, 2, 2, 2, 100, 0, 0, 100, 0.00, ISNULL(SUM(ISNULL(dbo.fn_GetConcep(id_pv, cod_moneda,2,2),0)),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_header_wkf WHERE id_pv = 50614013
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                IF @cod_concepto = dbo.CONST_EMI_DER_EMI()
                                SET @imp_base = dbo.fn_BaseConcepto(@id_pv_wkf, @cod_moneda,@cod_tipo_concepto,@cod_concepto)
                                    IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                    IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                    SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                                    IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                                    IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                                    SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                                RETURN dbo.RedondeaImporteEmision(@imp_concepto, @cod_moneda)
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 0, 2, 2, 2, 100, 0, imp_base_calculo * 29544.6900, 100, 0.00, dbo.RedondeaImporteEmision((imp_concepto * 29544.6900),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_importe_concepto_wkf WHERE id_pv = 50614013AND cod_moneda = 4 AND cod_tipo_concepto = 2 AND cod_concepto = 2
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 4, 2, 4, 3, 100, 0, 0, 100, 0.00, ISNULL(SUM(ISNULL(dbo.fn_GetConcep(id_pv, cod_moneda,2,4),0)),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_header_wkf WHERE id_pv = 50614013
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                SELECT @imp_concepto = dbo.fn_BaseConcepto(@id_pv_wkf, @cod_moneda,@cod_tipo_concepto,@cod_concepto) * (tp.pje_rec_fin / 100) FROM pv_pagador_wkf pp INNER JOIN tppago tp ON tp.cod_ppago = pp.cod_ppago WHERE pp.id_pv = @id_pv_wkf
                                    IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                    IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                        if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                                    SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                                    IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                                    IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                                        if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                                    SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                                IF @cod_concepto = dbo.CONST_EMI_DER_EMI()
                                RETURN dbo.RedondeaImporteEmision(@imp_concepto, @cod_moneda)
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 0, 2, 4, 3, 100, 0, imp_base_calculo * 29544.6900, 100, 0.00, dbo.RedondeaImporteEmision((imp_concepto * 29544.6900),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_importe_concepto_wkf WHERE id_pv = 50614013AND cod_moneda = 4 AND cod_tipo_concepto = 2 AND cod_concepto = 4
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 4, 2, 5, 4, 100, 0, 0, 100, 0.00, ISNULL(SUM(ISNULL(dbo.fn_GetConcep(id_pv, cod_moneda,2,5),0)),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_header_wkf WHERE id_pv = 50614013
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                SELECT @imp_concepto = dbo.fn_BaseConcepto(@id_pv_wkf, @cod_moneda,@cod_tipo_concepto,@cod_concepto) * (tp.pje_rec_fin / 100) FROM pv_pagador_wkf pp INNER JOIN tppago tp ON tp.cod_ppago = pp.cod_ppago WHERE pp.id_pv = @id_pv_wkf
                                    IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                    IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                    IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                        if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                                    SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                                    SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                                    SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                                    IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                                    IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                                    SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                                IF @cod_concepto = dbo.CONST_EMI_DER_EMI()
                                RETURN dbo.RedondeaImporteEmision(@imp_concepto, @cod_moneda)
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 0, 2, 5, 4, 100, 0, imp_base_calculo * 29544.6900, 100, 0.00, dbo.RedondeaImporteEmision((imp_concepto * 29544.6900),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_importe_concepto_wkf WHERE id_pv = 50614013AND cod_moneda = 4 AND cod_tipo_concepto = 2 AND cod_concepto = 5
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 4, 2, 9, 5, 100, 0, 0, 100, 0.00, ISNULL(SUM(ISNULL(dbo.fn_GetConcep(id_pv, cod_moneda,2,9),0)),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_header_wkf WHERE id_pv = 50614013
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                IF @cod_concepto = dbo.CONST_EMI_DER_EMI()
                                RETURN dbo.RedondeaImporteEmision(@imp_concepto, @cod_moneda)
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 0, 2, 9, 5, 100, 0, imp_base_calculo * 29544.6900, 100, 0.00, dbo.RedondeaImporteEmision((imp_concepto * 29544.6900),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_importe_concepto_wkf WHERE id_pv = 50614013AND cod_moneda = 4 AND cod_tipo_concepto = 2 AND cod_concepto = 9
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 4, 2, 13, 6, 100, 0, 0, 100, 0.00, ISNULL(SUM(ISNULL(dbo.fn_GetConcep(id_pv, cod_moneda,2,13),0)),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_header_wkf WHERE id_pv = 50614013
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                                IF @cod_concepto = dbo.CONST_EMI_DER_EMI()
                                RETURN dbo.RedondeaImporteEmision(@imp_concepto, @cod_moneda)
                            INSERT INTO pv_importe_concepto_wkf SELECT 50614013, 0, 2, 13, 6, 100, 0, imp_base_calculo * 29544.6900, 100, 0.00, dbo.RedondeaImporteEmision((imp_concepto * 29544.6900),0), 0, 0, 0, 0, 0, 0, 0 FROM pv_importe_concepto_wkf WHERE id_pv = 50614013AND cod_moneda = 4 AND cod_tipo_concepto = 2 AND cod_concepto = 13
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SET @imp_iva = dbo.RedondeaImporteEmision((@imp_iva * @imp_cambio), @cod_moneda)
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SET @imp_iva = dbo.RedondeaImporteEmision((@imp_iva * @imp_cambio), @cod_moneda)
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SET @imp_iva = dbo.RedondeaImporteEmision((@imp_iva * @imp_cambio), @cod_moneda)
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                        UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , pje_tasa = CASE WHEN dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto) = 0 THEN 0 ELSE isnull((imp_concepto / dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto)) * 100 ,0)END WHERE id_pv = @id_pv and cod_tipo_concepto = 2
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                            IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                            IF @cod_concepto <> 1 AND @cod_concepto <> dbo.CONST_EMI_DESCUENTO()
                            SET @imp_base = dbo.RedondeaImporteEmision((@imp_base - @imp_descuento), @cod_moneda)
                    if dbo.emi_sn_nuevo_calc_recargo(@id_pv,-1) = 0
                        if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                    EXEC ACC.GET_TAX @codAbona = @cod_abona, @branchCode = @cod_suc, @individualId = @cod_aseg, @impTotal = @imp_prima, @codCpto = NULL, @agentTypeCode = NULL, @codUsuario = @cod_usuario, @factCorrela = NULL, @currencyId = 0, @currencyValue = @imp_cambio, @random = @id_pv, @codProcess = 9
                        exec dbo.spi_calculo_impuesto @cod_suc = @branchCode ,@cod_abona = @codAbona ,@cod_persona = @individualId ,@cambio = @currencyValue ,@cod_moneda =@currencyId ,@imp_total = @impTotal ,@cod_cpto = @codCpto ,@int_rnd = @random ,@cod_usuario = @codUsuario ,@nro_correla_fac = @factCorrela ,@cod_copto = @codCpto ,@cod_costo = NULL ,@cod_tipo_agente = @agentTypeCode ,@sn_recobro = NULL ,@fec_factura =@fecFactura ,@fec_pago =@fecPago ,@codProcess = @codProcess
                            EXEC emi_usp_recup_impuesto_persona @cod_ramo = @cod_ramo, @cod_abona = @cod_abona, @imp_total = @imp_total, @id_pv = @int_rnd, @id_persona = @id_persona, @cod_pais = @cod_pais
                            EXEC emi_usp_get_base_imponible @cod_impuesto = @cod_impuesto, @cod_usuario = @cod_usuario, @int_rnd = @int_rnd, @cod_condicion = @cod_condicion, @cod_proceso = @codProcess
                                EXEC revisa_importe_emision_tempdb_core
                                SET @BASECALCULO = @BASECALCULO * dbo.fn_PjePrimaAfecta(@int_rnd,@cod_proceso)
                                    if dbo.emi_sn_nuevo_calc_recargo(@id_pv,-1) = -1
                                        if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                                UPDATE tmp_calcula_imp SET imp_total = dbo.RedondeaImporteEmision(@BASECALCULO, @cod_moneda) WHERE cod_impuesto = @cod_impuesto AND cod_usuario = @cod_usuario AND int_rnd = @int_rnd AND cod_condicion = @cod_condicion AND cod_dpto = @cod_dpto
                            UPDATE tmp_calcula_imp SET tmp_calcula_imp.imp_acumulado = ISNULL([dbo].[fn_Baseimpuesto](@int_rnd, @cod_usuario),0) WHERE int_rnd = @int_rnd AND cod_usuario = @cod_usuario
                                SET @imp_ACUM = dbo.RedondeaImporteEmision(@imp_ACUM, @cod_moneda)
                            UPDATE tmp_calcula_imp SET tmp_calcula_imp.imp_acumulado = ISNULL([dbo].[fn_Baseimpuesto](@int_rnd, @cod_usuario),0) WHERE int_rnd = @int_rnd AND cod_usuario = @cod_usuario
                                SET @imp_ACUM = dbo.RedondeaImporteEmision(@imp_ACUM, @cod_moneda)
                                EXEC usp_calculo_impuesto_ramo 31, 0, 1 , 'DEMO', 50614013, 329238, 0
                            EXEC emi_usp_get_base_imponible @cod_impuesto = @cod_impuesto, @cod_usuario = @cod_usuario, @int_rnd = @int_rnd, @cod_condicion = @cod_condicion, @cod_proceso = @codProcess
                                EXEC revisa_importe_emision_tempdb_core
                                UPDATE tmp_calcula_imp SET imp_total = dbo.RedondeaImporteEmision(@BASECALCULO, @cod_moneda) WHERE cod_impuesto = @cod_impuesto AND cod_usuario = @cod_usuario AND int_rnd = @int_rnd AND cod_condicion = @cod_condicion AND cod_dpto = @cod_dpto
                            UPDATE tmp_calcula_imp SET tmp_calcula_imp.imp_acumulado = ISNULL([dbo].[fn_Baseimpuesto](@int_rnd, @cod_usuario),0) WHERE int_rnd = @int_rnd AND cod_usuario = @cod_usuario
                                SET @imp_ACUM = dbo.RedondeaImporteEmision(@imp_ACUM, @cod_moneda)
                            UPDATE tmp_calcula_imp SET tmp_calcula_imp.imp_acumulado = ISNULL([dbo].[fn_Baseimpuesto](@int_rnd, @cod_usuario),0) WHERE int_rnd = @int_rnd AND cod_usuario = @cod_usuario
                                SET @imp_ACUM = dbo.RedondeaImporteEmision(@imp_ACUM, @cod_moneda)
                                EXEC usp_calculo_impuesto_iva_emi 1, 1, 1 , 'DEMO', 50614013, 329238, 0
                        exec dbo.spi_consulta_imp @cod_abona = @codAbona ,@cod_persona = @individualId ,@cod_usuario = @codUsuario ,@cod_consulta = @codProcess ,@nro_correla_Fac = NULL ,@cod_tipo_agente = @agentTypeCode ,@RND = @random
                    UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , imp_concepto = isnull(dbo.fn_GetConcep(@id_pv, pv_importe_concepto_wkf.cod_moneda,2,cod_concepto),0) WHERE id_pv = @id_pv and cod_tipo_concepto = 2 and (cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or cod_concepto = dbo.CONST_EMI_REC_FINC_EX())
                    UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , imp_concepto = isnull(dbo.fn_GetConcep(@id_pv, pv_importe_concepto_wkf.cod_moneda,2,cod_concepto),0) WHERE id_pv = @id_pv and cod_tipo_concepto = 2 and (cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or cod_concepto = dbo.CONST_EMI_REC_FINC_EX())
                    UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , imp_concepto = isnull(dbo.fn_GetConcep(@id_pv, pv_importe_concepto_wkf.cod_moneda,2,cod_concepto),0) WHERE id_pv = @id_pv and cod_tipo_concepto = 2 and (cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or cod_concepto = dbo.CONST_EMI_REC_FINC_EX())
                    UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , imp_concepto = isnull(dbo.fn_GetConcep(@id_pv, pv_importe_concepto_wkf.cod_moneda,2,cod_concepto),0) WHERE id_pv = @id_pv and cod_tipo_concepto = 2 and (cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or cod_concepto = dbo.CONST_EMI_REC_FINC_EX())
                    UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , imp_concepto = isnull(dbo.fn_GetConcep(@id_pv, pv_importe_concepto_wkf.cod_moneda,2,cod_concepto),0) WHERE id_pv = @id_pv and cod_tipo_concepto = 2 and (cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or cod_concepto = dbo.CONST_EMI_REC_FINC_EX())
                    UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , imp_concepto = isnull(dbo.fn_GetConcep(@id_pv, pv_importe_concepto_wkf.cod_moneda,2,cod_concepto),0) WHERE id_pv = @id_pv and cod_tipo_concepto = 2 and (cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or cod_concepto = dbo.CONST_EMI_REC_FINC_EX())
                        IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                        IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                        SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                        SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                        SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                        SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                        SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                        SELECT @imp_descuento = ISNULL(SUM(imp_concepto),0) FROM pv_importe_concepto_wkf WHERE id_pv = @id_pv_wkf AND cod_tipo_concepto = 2 AND cod_concepto = dbo.CONST_EMI_DESCUENTO() AND cod_moneda = @cod_moneda
                        IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF()
                        IF dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = 0
                            if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                        SET @imp_iva = dbo.RedondeaImporteEmision((@imp_iva * @imp_cambio), @cod_moneda)
                        SET @imp_base = dbo.RedondeaImporteEmision((@imp_base + ISNULL(@imp_iva,0)), @cod_moneda)
                    UPDATE pv_importe_concepto_wkf SET imp_base_calculo = isnull(dbo.fn_BaseConcepto(id_pv, cod_moneda,cod_tipo_concepto, cod_concepto),0) , imp_concepto = isnull(dbo.fn_GetConcep(@id_pv, pv_importe_concepto_wkf.cod_moneda,2,cod_concepto),0) WHERE id_pv = @id_pv and cod_tipo_concepto = 2 and (cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or cod_concepto = dbo.CONST_EMI_REC_FINC_EX())
                        IF @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()
                        SELECT @imp_concepto = dbo.fn_BaseConcepto(@id_pv_wkf, @cod_moneda,@cod_tipo_concepto,@cod_concepto) * (tp.pje_rec_fin / 100) FROM pv_pagador_wkf pp INNER JOIN tppago tp ON tp.cod_ppago = pp.cod_ppago WHERE pp.id_pv = @id_pv_wkf
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                            IF (@cod_concepto = dbo.CONST_EMI_REC_FINC_AF() or @cod_concepto = dbo.CONST_EMI_REC_FINC_EX()) and dbo.emi_sn_nuevo_calc_recargo(@id_pv_wkf,-1) = -1
                                if @fec_emi < dbo.emi_fec_corte_calc_recargo()
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario
                            SELECT @imp_base = SUM(dci.imp_prima) ,@cod_usuario = pv.cod_usuario FROM di_cober_wkf dc INNER JOIN pv_header_wkf ph ON ph.id_pv = dc.id_pv INNER JOIN di_cober_imp_wkf dci ON dci.id_pv = dc.id_pv AND dci.cod_item = dc.cod_item AND dci.cod_ind_cob = dc.cod_ind_cob AND dci.cod_moneda = @cod_moneda INNER JOIN pv_varios_wkf pv ON pv.id_pv = dc.id_pv WHERE dc.id_pv = @id_pv_wkf AND dc.sn_acum_prima_total = -1 AND isnull(dc.sn_aplica_iva,0) = (case when @cod_concepto = dbo.CONST_EMI_REC_FINC_AF() then -1 else 0 end) GROUP BY pv.cod_usuario